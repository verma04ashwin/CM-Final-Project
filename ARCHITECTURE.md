# System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FHIR STROKE PREDICTION SYSTEM                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Browser       â”‚
â”‚   (User Interface)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ HTTP
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Node.js Express Server (Port 3001)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Web UI      â”‚  â”‚   FHIR API     â”‚  â”‚  Prediction API  â”‚          â”‚
â”‚  â”‚  (EJS Views)  â”‚  â”‚  (/fhir/*)     â”‚  â”‚  (/predict/:id)  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                    â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Routes Layer                  â”‚                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ fhirApi.js      â€¢ upload.js                 â”‚                 â”‚ â”‚
â”‚  â”‚  â€¢ predict.js      â€¢ fhirProxy.js              â–¼                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Models Layer                  â”‚                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ Patient.js (FHIR R4)                        â”‚                 â”‚ â”‚
â”‚  â”‚  â€¢ Observation.js (FHIR R4)                    â”‚                 â”‚ â”‚
â”‚  â”‚  â€¢ Condition.js (FHIR R4)                      â”‚                 â”‚ â”‚
â”‚  â”‚  â€¢ RiskAssessment.js (FHIR R4)                 â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚                  â”‚
                                    â”‚ Mongoose         â”‚ Axios HTTP
                                    â–¼                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    MongoDB      â”‚  â”‚  Flask Model Service   â”‚
                        â”‚  (Port 27017)   â”‚  â”‚    (Port 5000)         â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚ Collections:    â”‚  â”‚  â€¢ /health             â”‚
                        â”‚  - patients     â”‚  â”‚  â€¢ /model/info         â”‚
                        â”‚  - observations â”‚  â”‚  â€¢ /predict (POST)     â”‚
                        â”‚  - conditions   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚  - risk-        â”‚              â”‚
                        â”‚    assessments  â”‚              â”‚ TensorFlow
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚   stroke_model.h5      â”‚
                                              â”‚  (Keras/TensorFlow)    â”‚
                                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                              â”‚ Input: 10 features     â”‚
                                              â”‚ Output: probability    â”‚
                                              â”‚ (stroke risk 0-1)      â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                            DATA FLOW: PREDICTION

1. User clicks "Predict Risk" for Patient P001
                    â”‚
                    â–¼
2. POST /predict/P001 â†’ Node.js Server
                    â”‚
                    â–¼
3. Fetch FHIR Resources:
   â€¢ Patient/P001 â†’ age, gender, marital status, residence
   â€¢ Condition?subject=Patient/P001 â†’ hypertension, heart_disease
   â€¢ Observation?subject=Patient/P001 â†’ BMI, glucose, smoking
                    â”‚
                    â–¼
4. Extract Features:
   {
     age: 67,
     gender: "male",
     hypertension: 1,
     heart_disease: 1,
     ever_married: 1,
     work_type: 0,
     Residence_type: 1,
     avg_glucose_level: 228.69,
     bmi: 36.6,
     smoking_status: "formerly smoked"
   }
                    â”‚
                    â–¼
5. POST http://localhost:5000/predict
   { "features": {...} }
                    â”‚
                    â–¼
6. Flask Service:
   â€¢ Preprocess features (encode, normalize)
   â€¢ Load stroke_model.h5
   â€¢ model.predict(features)
   â€¢ Return probability
                    â”‚
                    â–¼
7. Response: { "probability": 0.734, "risk_level": "high" }
                    â”‚
                    â–¼
8. Create RiskAssessment Resource:
   {
     resourceType: "RiskAssessment",
     status: "final",
     subject: { reference: "Patient/P001" },
     prediction: [{
       probabilityDecimal: 0.734,
       qualitativeRisk: { text: "High risk" }
     }]
   }
                    â”‚
                    â–¼
9. Save to MongoDB
                    â”‚
                    â–¼
10. Return to User:
    "Stroke Risk: 73.4% (High Risk)"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                         FEATURE EXTRACTION MAP

FHIR Resource              Field                    Model Feature
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Patient                    birthDate                age (calculated)
Patient                    gender                   gender (male/female)
Patient                    maritalStatus            ever_married (0/1)
Patient                    address[0].city          Residence_type (0/1)
Patient                    extension                work_type (0-4)

Condition (SNOMED:         code.coding[0].code      hypertension (0/1)
  38341003 or ICD:I10)

Condition (SNOMED:         code.coding[0].code      heart_disease (0/1)
  56265001 or ICD:I51.9)

Observation (LOINC:        valueQuantity.value      avg_glucose_level
  2339-0)

Observation (LOINC:        valueQuantity.value      bmi
  39156-5)

Observation (LOINC:        valueCodeableConcept     smoking_status
  72166-2)                 .text                    (0=never, 1=formerly,
                                                     2=smokes, 3=unknown)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                            FILE STRUCTURE

CM-Final-Project/
â”‚
â”œâ”€â”€ ğŸ Python (Model Service)
â”‚   â”œâ”€â”€ model_service.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Flask web service
â”‚   â”œâ”€â”€ stroke_model.h5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Trained TensorFlow model
â”‚   â”œâ”€â”€ test_model.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Model test suite
â”‚   â””â”€â”€ requirements.txt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Python dependencies
â”‚
â”œâ”€â”€ ğŸŸ¢ Node.js (FHIR Server)
â”‚   â”œâ”€â”€ server.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main Express app
â”‚   â”œâ”€â”€ package.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Node dependencies
â”‚   â”‚
â”‚   â”œâ”€â”€ models/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FHIR R4 Schemas
â”‚   â”‚   â”œâ”€â”€ Patient.js
â”‚   â”‚   â”œâ”€â”€ Observation.js
â”‚   â”‚   â”œâ”€â”€ Condition.js
â”‚   â”‚   â””â”€â”€ RiskAssessment.js
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ API Endpoints
â”‚   â”‚   â”œâ”€â”€ fhirApi.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RESTful FHIR API
â”‚   â”‚   â”œâ”€â”€ predict.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Prediction integration
â”‚   â”‚   â”œâ”€â”€ upload.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CSV import
â”‚   â”‚   â””â”€â”€ fhirProxy.js
â”‚   â”‚
â”‚   â”œâ”€â”€ views/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Web UI (EJS)
â”‚   â”‚   â”œâ”€â”€ index.ejs
â”‚   â”‚   â”œâ”€â”€ patients.ejs
â”‚   â”‚   â””â”€â”€ patient.ejs
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ fhirValidation.js
â”‚
â”œâ”€â”€ ğŸ“œ PowerShell Scripts
â”‚   â”œâ”€â”€ start-services.ps1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Start both services
â”‚   â””â”€â”€ stop-services.ps1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Stop both services
â”‚
â”œâ”€â”€ ğŸ“š Documentation
â”‚   â”œâ”€â”€ README.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main documentation
â”‚   â”œâ”€â”€ MODEL_INTEGRATION.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ML integration guide
â”‚   â”œâ”€â”€ PREDICTION_QUICKSTART.md â”€â”€â”€â”€â”€â”€ 5-min quick start
â”‚   â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md â”€â”€â”€â”€â”€ This implementation
â”‚   â””â”€â”€ TRANSFORMATION_SUMMARY.md â”€â”€â”€â”€â”€ Project changelog
â”‚
â””â”€â”€ ğŸ§ª Testing
    â”œâ”€â”€ test_model.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Model service tests
    â”œâ”€â”€ test-server.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Full system tests
    â””â”€â”€ sample-data.csv â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Test data

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                         STARTUP COMMANDS

Quick Start (Automated):
  .\start-services.ps1

Manual Start:
  Terminal 1: python model_service.py
  Terminal 2: node server.js

Stop Services:
  .\stop-services.ps1

Test:
  python test_model.py
  npm test

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
